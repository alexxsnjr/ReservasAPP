<template>
    <div>
        <md-dialog :md-active.sync="showDialog">
            <md-card>
                <md-card-media>

                    <div class="perfil">

                        <div class="top-bar">
                            <button @click="back"><i class="material-icons">keyboard_backspace</i></button>
                            <div>
                                <button @click="done"><i class="material-icons">done</i></button>
                                <button @click="activeChangePassword = true"><i class="material-icons">more_vert</i>
                                </button>

                            </div>
                        </div>

                    </div>
                </md-card-media>

                <md-card-content>


                                <md-field :class="getValidationClass('name')">

                                    <label>Full name</label>
                                    <md-input v-model="usu.name" autofocus></md-input>
                                    <span class="md-error" v-if="!$v.usu.name.required">The  name is required</span>
                                    <span class="md-error" v-else-if="!$v.usu.name.minlength">Invalid  name</span>
                                </md-field>




                        <md-divider class="md-inset"></md-divider>


                                <md-field :class="getValidationClass('email')">
                                    <label>Email</label>
                                    <md-input v-model="usu.email" type="email"></md-input>
                                    <span class="md-error" v-if="!$v.usu.email.required">The email is required</span>
                                    <span class="md-error" v-else-if="!$v.usu.email.email">Invalid email</span>
                                </md-field>






                </md-card-content>
            </md-card>

        </md-dialog>

        <!-- Dialog para cambiar password-->


        <div>
            <md-dialog :md-active.sync="activeChangePassword">
                <md-dialog-title>Change password</md-dialog-title>
                <div class="FormPassword">
                    <md-field :md-toggle-password="false">
                        <label>Old Password</label>
                        <md-input v-model="password.old" type="password"></md-input>
                    </md-field>

                    <md-field :md-toggle-password="false">
                        <label>New Password</label>
                        <md-input v-model="password.new" type="password"></md-input>
                    </md-field>

                    <md-field :md-toggle-password="false">
                        <label>Repeat Password</label>
                        <md-input v-model="password.repeat" type="password"></md-input>
                    </md-field>


                    <md-dialog-actions>
                        <md-button @click="cancel" class="md-dense md-primary">CANCEL</md-button>
                        <md-button @click="activeChangePassword = false" class="md-dense md-primary">CHANGE</md-button>
                    </md-dialog-actions>
                </div>

            </md-dialog>

        </div>

    </div>
</template>

<script>
    import { validationMixin } from 'vuelidate'
    import {
        required,
        email,
        minLength,
        maxLength
    } from 'vuelidate/lib/validators'
    export default {
        mixins: [validationMixin],
        name: 'DialogCustom',
        data: () => ({
            showDialog: true,
            activeChangePassword: false,
            usu: {
                name : '',
                email: '',
            },
            password: {
                old: '',
                new: '',
                repeat: '',
            },
        }),
        mounted() {
            var stateUsu = this.$store.getters.getUser;
            this.usu.name =  stateUsu.name;
            this.usu.email = stateUsu.email;

        },
        props: ['user'],
        validations: {
            usu: {
                name: {
                    required,
                    minLength: minLength(3)
                },
                email: {
                    required,
                    email
                }
            }
        },
        methods: {
            getValidationClass (fieldName) {
                const field = this.$v.usu[fieldName]

                if (field) {
                    return {
                        'md-invalid': field.$invalid && field.$dirty
                    }
                }
            },
            back() {
                this.$emit('view');
            },
            done() {
                this.$v.$touch()

                if (!this.$v.$invalid) {
                    this.user.name = this.usu.name;
                    this.user.email = this.usu.email;
                    this.$store.dispatch('updateUser', {
                        name : this.usu.name,
                        email : this.usu.email,

                    })
                    this.back();
                }

            },
            cancel() {
                this.activeChangePassword = false
                this.password.old = '';
                this.password.new = '';
                this.password.repeat = '';
            }
        }
    }
</script>

<style lang="scss" scoped>

    .md-dialog {
        min-width: 290px;

    }

    @media (min-width: 602px) and (max-width: 1030px) {
        .md-dialog {
            margin-left: 20%;
        }
    }

    @media (max-height: 670px) {
        .md-dialog {
            overflow-y: scroll;
        }
    }

    button {

        background: transparent;
        border: none !important;
        font-size: 0;
    }

    .top-bar {
        background-color: #C5D639;
        padding-top: 10px;

    }

    .top-bar div {
        float: right;

    }

    .md-card-content {
        max-width: 300px;
    }

    .iconPhoto {
        position: absolute;
        left: 85%;
        top: 90%;
    }

    .FormPassword {
        padding: 15px;
    }
</style>
